---
name: test-driven-development
description: Use when implementing code changes where unit tests are skipped. Enforce a lightweight implement -> targeted build -> fix loop with compile evidence.
---

# Test-Driven Development（简化版：编译验证驱动）

本技能在当前阶段**不要求编写单测**。核心目标是：实现改动并确保编译/构建通过。

如用户明确要求测试，再额外补充测试；默认只做编译验证。

---

## 工作流程检查清单（强制执行）

```
Build Loop Progress:
- [ ] 步骤 1: 明确变更范围与验收
- [ ] 步骤 2: 最小实现改动
- [ ] 步骤 3: 编译/构建验证（最小化优先）
- [ ] 步骤 4: 修复编译错误并复验
- [ ] 步骤 5: 记录验证结果
```

**重要**：完成每个步骤后，更新检查清单。不要跳过任何步骤。

---

## 步骤 1: 明确变更范围与验收

**必须明确**：
- 改动涉及的文件/模块
- 编译目标（优先子模块/指定入口，避免全量）
- 验收标准（编译成功）

如果范围不清晰，先回到 tasks.md 或设计说明补全。

---

## 步骤 2: 最小实现改动

**原则**：只实现完成当前任务所需的最小改动，避免范围蔓延。

---

## 步骤 3: 编译/构建验证（最小化优先）

**通用原则**：优先编译受影响的最小闭包；仅当用户明确要求或任务明确要求全量编译时，才允许全量编译。

**执行约束**：
- 目标编译通过后，**不要**再无条件追加 `go build ./...`
- 除非用户明确要求或任务要求，否则禁止执行 `go build ./...`
- 禁止使用 `go build -v ./...` 作为默认命令（除非用户明确要求 verbose 全量编译）

### Go 项目示例

**仅编译入口**（如只改动服务启动代码）：
```bash
go build ./cmd/...
```

**仅编译指定包**（如只改动某个模块）：
```bash
go build ./path/to/pkg
```

**仅编译指定目录**（如只改动 handler 或 biz 子目录）：
```bash
go build ./handler/...
go build ./biz/domain/operator/...
```

**仅当用户明确要求时的全量编译**（必须注明原因）：
```bash
go build ./...
```

### 其他语言项目

使用项目已有的构建命令（如 `npm run build`、`pnpm build`、`make build`）。
如果没有构建命令，至少保证受影响模块可编译或可被引用构建。

---

## 步骤 4: 修复编译错误并复验

**要求**：
- 修复后必须重新编译
- 直到编译通过为止
- 不可用“跳过编译”代替

---

## 步骤 5: 记录验证结果

**记录要素**：
- 使用的编译命令
- 编译结果（通过/失败）
- 若失败，记录关键错误信息

**示例**：
```markdown
## 编译验证

- 命令：go build ./handler/...
- 结果：✅ 通过
```

**如执行全量编译，必须附原因（用户明确要求）**：
```markdown
## 编译验证

- 命令：go build ./...
- 原因：用户明确要求全量编译
- 结果：✅ 通过
```

---

## 适用场景

- 改动较小、逻辑简单
- 测试成本高或测试缺失
- 以“编译通过”为最低质量门

---

## 禁止行为

- ❌ 跳过编译验证
- ❌ 未编译就标记完成
- ❌ 伪造或猜测编译结果
- ❌ 目标编译通过后仍无必要执行全量编译

---

## MCP 工具使用

- `Bash` - 运行编译/构建命令
- `Read` - 阅读错误输出或相关文件
- `Grep` - 定位错误引用（可选）

---

## 输出格式

**技能完成时应包含**：

1. **Build Loop 检查清单**（所有项目已勾选）
2. **编译验证记录**（命令 + 结果）
3. **改动摘要**（涉及文件/模块）

**示例输出**：
```markdown
## 编译验证完成

### Build Loop
✓ 所有 5 个步骤已完成

### 编译验证
- 命令：go build ./handler/...
- 结果：✅ 通过

### 改动摘要
- 修改文件：src/foo/bar.go
```

---

## 技能元数据

- **技能类型**：开发类技能（简化版）
- **强制流程**：是（实现 → 编译 → 记录）
- **核心铁律**：没有编译通过，就不能标记完成
